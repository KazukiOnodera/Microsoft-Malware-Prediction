#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Jan 22 21:53:46 2019

@author: kazuki.onodera
"""

import numpy as np
import pandas as pd
import os, gc
from multiprocessing import Pool

import utils


for d in ['../data', '../feature']:
    os.system(f'rm -rf {d}')
    os.system(f'mkdir  {d}')



def main(args):
    
    input_path, output_path = args
    df = pd.read_csv(input_path, dtype=utils.DTYPES)
    utils.reduce_mem_usage(df)
    df.to_feather(output_path)
    
    if 'train' in input_path:
        df[['HasDetections']].to_feather('../data/target.f')
    
    return


# =============================================================================
# main
# =============================================================================
if __name__ == "__main__":
    utils.start(__file__)
    
    argss = []
    argss.append(['../input/train.csv.zip', '../data/train.f'])
    argss.append(['../input/test.csv.zip', '../data/test.f'])
    
    pool = Pool( 2 )
    pool.map(main, argss)
    pool.close()
    
    utils.end(__file__)


