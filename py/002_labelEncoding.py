#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Jan 23 21:49:53 2019

@author: kazuki.onodera
"""

import numpy as np
import pandas as pd
#from multiprocessing import Pool
from sklearn.preprocessing import LabelEncoder

import utils

PREF = 'f002'


col_cat = utils.COL_CAT



# =============================================================================
# main
# =============================================================================
if __name__ == "__main__":
    utils.start(__file__)
    
    tr = pd.read_feather('../data/train.f')[col_cat]
    te = pd.read_feather('../data/test.f')[col_cat]
    
    
    le = LabelEncoder()
    for c in col_cat:
        tr[c].fillna('na dayo', inplace=True)
        te[c].fillna('na dayo', inplace=True)
        le.fit( tr[c].append(te[c]) )
        tr[c] = le.transform(tr[c])
        te[c]  = le.transform(te[c])
    
    utils.reduce_mem_usage(tr)
    utils.reduce_mem_usage(te)
    
    tr.add_prefix(PREF+'_').to_feather(f'../data/train_{PREF}.f')
    te.add_prefix(PREF+'_').to_feather(f'../data/test_{PREF}.f')
    
    
    print('==== categories ====')
    print(tr.head().add_prefix(PREF+'_').columns.tolist())
    
    utils.end(__file__)
