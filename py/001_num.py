#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Jan 23 21:27:33 2019

@author: kazuki.onodera
"""

import numpy as np
import pandas as pd
from multiprocessing import Pool
import utils

PREF = 'f001'


col_num = ['IsBeta',
         'RtpStateBitfield',
         'IsSxsPassiveMode',
         'DefaultBrowsersIdentifier',
         'AVProductStatesIdentifier',
         'AVProductsInstalled',
         'AVProductsEnabled',
         'HasTpm',
         'CountryIdentifier',
         'CityIdentifier',
         'OrganizationIdentifier',
         'GeoNameIdentifier',
         'LocaleEnglishNameIdentifier',
         'OsBuild',
         'OsSuite',
         'IsProtected',
         'AutoSampleOptIn',
         'SMode',
         'IeVerIdentifier',
         'Firewall',
         'UacLuaenable',
         'Census_OEMNameIdentifier',
         'Census_OEMModelIdentifier',
         'Census_ProcessorCoreCount',
         'Census_ProcessorManufacturerIdentifier',
         'Census_ProcessorModelIdentifier',
         'Census_PrimaryDiskTotalCapacity',
         'Census_SystemVolumeTotalCapacity',
         'Census_HasOpticalDiskDrive',
         'Census_TotalPhysicalRAM',
         'Census_InternalPrimaryDiagonalDisplaySizeInInches',
         'Census_InternalPrimaryDisplayResolutionHorizontal',
         'Census_InternalPrimaryDisplayResolutionVertical',
         'Census_InternalBatteryNumberOfCharges',
         'Census_OSBuildNumber',
         'Census_OSBuildRevision',
         'Census_OSInstallLanguageIdentifier',
         'Census_OSUILocaleIdentifier',
         'Census_IsPortableOperatingSystem',
         'Census_IsFlightingInternal',
         'Census_IsFlightsDisabled',
         'Census_ThresholdOptIn',
         'Census_FirmwareManufacturerIdentifier',
         'Census_FirmwareVersionIdentifier',
         'Census_IsSecureBootEnabled',
         'Census_IsWIMBootEnabled',
         'Census_IsVirtualDevice',
         'Census_IsTouchEnabled',
         'Census_IsPenCapable',
         'Census_IsAlwaysOnAlwaysConnectedCapable',
         'Wdft_IsGamer',
         'Wdft_RegionIdentifier'
         ]


def main(args):
    """
    
    input_path, output_path = '../data/train.pkl', f'../data/train_{PREF}.pkl'
    
    """
    
    input_path, output_path = args
    
    df = pd.read_pickle(input_path)[col_num]
    
    df.add_prefix(PREF+'_').to_pickle(output_path)
    
    return


# =============================================================================
# main
# =============================================================================
if __name__ == "__main__":
    utils.start(__file__)
    
    argss = []
    argss.append(['../data/train.pkl', f'../data/train_{PREF}.pkl'])
    argss.append(['../data/test.pkl',  f'../data/test_{PREF}.pkl'])
    
    pool = Pool( 2 )
    pool.map(main, argss)
    pool.close()
    
    utils.end(__file__)


